<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>iOS 线程、队列与派发 | Skybrim</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="iOS 线程、队列与派发">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS 线程、队列与派发">
<meta property="og:url" content="https://skybrim.top/2019/01/01/ios/thread-queue-dispatch/index.html">
<meta property="og:site_name" content="Skybrim">
<meta property="og:description" content="iOS 线程、队列与派发">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2018-12-31T16:00:00.000Z">
<meta property="article:modified_time" content="2020-12-10T02:48:42.068Z">
<meta property="article:author" content="Wiley">
<meta property="article:tag" content="iOS">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Skybrim" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Skybrim</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Practice makes perfect. Always.</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://skybrim.top"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-ios/thread-queue-dispatch" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/01/ios/thread-queue-dispatch/" class="article-date">
  <time datetime="2018-12-31T16:00:00.000Z" itemprop="datePublished">2019-01-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      iOS 线程、队列与派发
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>iOS 线程、队列与派发</p>
<a id="more"></a>

<h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><ul>
<li><p>线程(Thread)</p>
<p>  线程，是操作系统直接支持的执行单元，CPU调度的基本单位，是代码执行的路径；一个进程内至少包含一个线程。</p>
<p>  线程只拥有程序的少量资源，但是他与进程内的其他线程共享进程的整个内存空间；线程的切换速度远快于进程。</p>
</li>
<li><p>队列(Queue)</p>
<p>  队列是用于保存以及管理任务的，队列根据情况，调度线程来执行其中的任务。</p>
<p>  队列分为<strong>串行队列</strong>和<strong>并发队列</strong>；队列都是先进先出的。</p>
<ul>
<li><p>串行队列(SerialQueue)</p>
<p>  串行队列，需要等待前一个任务执行完成才能执行下个任务。</p>
<p>  串行队列只需要一个线程就可以完成任务的派发。</p>
</li>
<li><p>并发队列(ConcurrentQueue)</p>
<p>  并发队列，允许多个任务同时执行；</p>
<p>  并发队列，任务开始执行的时间是按照顺序的，但是任务结束时间并不确定。</p>
<p>  并发队列的并发执行，需要通过新建线程来实现</p>
</li>
<li><p>主队列</p>
<p>  主队列，是一种的特殊的串行队列；</p>
<p>  主队列的任务只能在主线程执行，并且需要等待主线程的 RunLoop 空闲时才能派发。</p>
</li>
</ul>
</li>
<li><p>派发</p>
<p>  GCD的派发，分为<strong>同步派发</strong>和<strong>异步派发</strong>。</p>
<ul>
<li><p>同步派发(dispatch_sync)</p>
<p>  同步派发任务，阻塞当前线程，并等待，直到任务执行完返回。</p>
</li>
<li><p>异步派发(dispatch_async)</p>
<p>  异步派发任务，不会阻塞当前线程，也不等待任务返回。</p>
</li>
</ul>
</li>
</ul>
<h2 id="实验"><a href="#实验" class="headerlink" title="实验"></a>实验</h2><h3 id="设计方案"><a href="#设计方案" class="headerlink" title="设计方案"></a>设计方案</h3><p><strong>注意，因为主线程是默认环境，所以代码是默认执行在主线程的</strong></p>
<p>两个线程：<strong>主线程</strong>  <strong>子线程</strong></p>
<p>三个队里：<strong>主队列</strong>  <strong>串行队列</strong>  <strong>并发队列</strong></p>
<p>两种派发：<strong>同步派发</strong>  <strong>异步派发</strong></p>
<p>将上述进行组合，共有 2 x 3 x 2 = 12 种情况</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通用方法，输出当前线程</span></span><br><span class="line">- (<span class="keyword">void</span>)printCurrentThread &#123;</span><br><span class="line">    <span class="built_in">NSThread</span> *currentThread = [<span class="built_in">NSThread</span> currentThread];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"cur = %@"</span>, currentThread);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="实验-1：在主线程中派发任务"><a href="#实验-1：在主线程中派发任务" class="headerlink" title="实验 1：在主线程中派发任务"></a>实验 1：在主线程中派发任务</h3><ul>
<li>在 <strong>主线程</strong> 向 <strong>主队列</strong> 执行 <strong>同步派发</strong></li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 情景 1：</span></span><br><span class="line"><span class="comment">// 在 **主线程** 向 **主队列** 执行 **同步派发**</span></span><br><span class="line"><span class="comment">// 结果：</span></span><br><span class="line"><span class="comment">// 程序崩溃</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"--start--"</span>);</span><br><span class="line"><span class="built_in">dispatch_queue_t</span> mainQueue = dispatch_get_main_queue();</span><br><span class="line"><span class="built_in">dispatch_sync</span>(mainQueue, ^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"task1--start"</span>);</span><br><span class="line">    [<span class="keyword">self</span> printCurrentThread];</span><br><span class="line">    sleep(<span class="number">3</span>);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"task1--end"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_sync</span>(mainQueue, ^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"task2--start"</span>);</span><br><span class="line">    [<span class="keyword">self</span> printCurrentThread];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"task2--end"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"--end--"</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>在 <strong>主线程</strong> 向 <strong>主队列</strong> 执行 <strong>异步派发</strong></li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 情景 2：</span></span><br><span class="line"><span class="comment">// 在 **主线程** 向 **主队列** 执行 **异步派发**</span></span><br><span class="line"><span class="comment">// 结果：</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> 14:51:12.     --start--</span></span><br><span class="line"><span class="comment"> 14:51:12.     --end--</span></span><br><span class="line"><span class="comment"> 14:51:12.     task1--start</span></span><br><span class="line"><span class="comment"> 14:51:12.     cur = **NSThread: 0x600000330100**&#123;number = 1, name = main&#125;</span></span><br><span class="line"><span class="comment"> 14:51:15.     task1--end</span></span><br><span class="line"><span class="comment"> 14:51:15.     task2--start</span></span><br><span class="line"><span class="comment"> 14:51:15.     cur = **NSThread: 0x600000330100**&#123;number = 1, name = main&#125;</span></span><br><span class="line"><span class="comment"> 14:51:15.     task2--end</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"--start--"</span>);</span><br><span class="line"><span class="built_in">dispatch_queue_t</span> mainQueue = dispatch_get_main_queue();</span><br><span class="line"><span class="built_in">dispatch_async</span>(mainQueue, ^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"task1--start"</span>);</span><br><span class="line">    [<span class="keyword">self</span> printCurrentThread];</span><br><span class="line">    sleep(<span class="number">3</span>);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"task1--end"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_async</span>(mainQueue, ^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"task2--start"</span>);</span><br><span class="line">    [<span class="keyword">self</span> printCurrentThread];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"task2--end"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"--end--"</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>在 <strong>主线程</strong> 向 <strong>串行队列</strong> 执行 <strong>同步派发</strong></li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 情景 3：</span></span><br><span class="line"><span class="comment">// 在 **主线程** 向 **串行队列** 执行 **同步派发**</span></span><br><span class="line"><span class="comment">// 结果</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> 15:10:51.     --start--</span></span><br><span class="line"><span class="comment"> 15:10:51.     task1--start</span></span><br><span class="line"><span class="comment"> 15:10:51.     cur = **NSThread: 0x600001340300**&#123;number = 1, name = main&#125;</span></span><br><span class="line"><span class="comment"> 15:10:54.     task1--end</span></span><br><span class="line"><span class="comment"> 15:10:54.     task2--start</span></span><br><span class="line"><span class="comment"> 15:10:54.     cur = **NSThread: 0x600001340300**&#123;number = 1, name = main&#125;</span></span><br><span class="line"><span class="comment"> 15:10:54.     task2--end</span></span><br><span class="line"><span class="comment"> 15:10:54.     --end--</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"--start--"</span>);</span><br><span class="line"><span class="built_in">dispatch_queue_t</span> serialQueue = dispatch_queue_create(<span class="string">"serialQueue"</span>,</span><br><span class="line">                                                   DISPATCH_QUEUE_SERIAL);</span><br><span class="line"><span class="built_in">dispatch_sync</span>(serialQueue, ^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"task1--start"</span>);</span><br><span class="line">    [<span class="keyword">self</span> printCurrentThread];</span><br><span class="line">    sleep(<span class="number">3</span>);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"task1--end"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_sync</span>(serialQueue, ^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"task2--start"</span>);</span><br><span class="line">    [<span class="keyword">self</span> printCurrentThread];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"task2--end"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"--end--"</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>在 <strong>主线程</strong> 向 <strong>串行队列</strong> 执行 <strong>异步派发</strong></li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 情景 4：</span></span><br><span class="line"><span class="comment">// 在 **主线程** 向 **串行队列** 执行 **异步派发**</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> 15:13:03.     --start--</span></span><br><span class="line"><span class="comment"> 15:13:03.     --end--</span></span><br><span class="line"><span class="comment"> 15:13:03.     task1--start</span></span><br><span class="line"><span class="comment"> 15:13:03.     cur = **NSThread: 0x6000035ecc80**&#123;number = 6, name = (null)&#125;</span></span><br><span class="line"><span class="comment"> 15:13:06.     task1--end</span></span><br><span class="line"><span class="comment"> 15:13:06.     task2--start</span></span><br><span class="line"><span class="comment"> 15:13:06.     cur = **NSThread: 0x6000035ecc80**&#123;number = 6, name = (null)&#125;</span></span><br><span class="line"><span class="comment"> 15:13:06.     task2--end</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"--start--"</span>);</span><br><span class="line"><span class="built_in">dispatch_queue_t</span> serialQueue = dispatch_queue_create(<span class="string">"serialQueue"</span>,</span><br><span class="line">                                                   DISPATCH_QUEUE_SERIAL);</span><br><span class="line"><span class="built_in">dispatch_async</span>(serialQueue, ^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"task1--start"</span>);</span><br><span class="line">    [<span class="keyword">self</span> printCurrentThread];</span><br><span class="line">    sleep(<span class="number">3</span>);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"task1--end"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_async</span>(serialQueue, ^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"task2--start"</span>);</span><br><span class="line">    [<span class="keyword">self</span> printCurrentThread];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"task2--end"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"--end--"</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>在 <strong>主线程</strong> 向 <strong>并发队列</strong> 执行 <strong>同步派发</strong></li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 情景 5：</span></span><br><span class="line"><span class="comment">// 在 **主线程** 向 **并发队列** 执行 **同步派发**</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> 15:20:01.    --start--</span></span><br><span class="line"><span class="comment"> 15:20:01.    task1--start</span></span><br><span class="line"><span class="comment"> 15:20:01.    cur = **NSThread: 0x60000000c380**&#123;number = 1, name = main&#125;</span></span><br><span class="line"><span class="comment"> 15:20:04.    task1--end</span></span><br><span class="line"><span class="comment"> 15:20:04.    task2--start</span></span><br><span class="line"><span class="comment"> 15:20:04.    cur = **NSThread: 0x60000000c380**&#123;number = 1, name = main&#125;</span></span><br><span class="line"><span class="comment"> 15:20:04.    task2--end</span></span><br><span class="line"><span class="comment"> 15:20:04.    --end--</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"--start--"</span>);</span><br><span class="line"><span class="built_in">dispatch_queue_t</span> concurrentQueue = dispatch_queue_create(<span class="string">"concurrentQueue"</span>,</span><br><span class="line">                                                   DISPATCH_QUEUE_CONCURRENT);</span><br><span class="line"><span class="built_in">dispatch_sync</span>(concurrentQueue, ^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"task1--start"</span>);</span><br><span class="line">    [<span class="keyword">self</span> printCurrentThread];</span><br><span class="line">    sleep(<span class="number">3</span>);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"task1--end"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_sync</span>(concurrentQueue, ^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"task2--start"</span>);</span><br><span class="line">    [<span class="keyword">self</span> printCurrentThread];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"task2--end"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"--end--"</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>在 <strong>主线程</strong> 向 <strong>并发队列</strong> 执行 <strong>异步派发</strong></li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 情景 6：</span></span><br><span class="line"><span class="comment">// 在 **主线程** 向 **并发队列** 执行 **异步派发**</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> 15:17:35.     --start--</span></span><br><span class="line"><span class="comment"> 15:17:35.     --end--</span></span><br><span class="line"><span class="comment"> 15:17:35.     task1--start</span></span><br><span class="line"><span class="comment"> 15:17:35.     task2--start</span></span><br><span class="line"><span class="comment"> 15:17:35.     cur = **NSThread: 0x6000004d4ec0**&#123;number = 3, name = (null)&#125;</span></span><br><span class="line"><span class="comment"> 15:17:35.     cur = **NSThread: 0x6000004d83c0**&#123;number = 4, name = (null)&#125;</span></span><br><span class="line"><span class="comment"> 15:17:35.     task2--end</span></span><br><span class="line"><span class="comment"> 15:17:38.     task1--end</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"--start--"</span>);</span><br><span class="line"><span class="built_in">dispatch_queue_t</span> concurrentQueue = dispatch_queue_create(<span class="string">"concurrentQueue"</span>,</span><br><span class="line">                                                   DISPATCH_QUEUE_CONCURRENT);</span><br><span class="line"><span class="built_in">dispatch_async</span>(concurrentQueue, ^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"task1--start"</span>);</span><br><span class="line">    [<span class="keyword">self</span> printCurrentThread];</span><br><span class="line">    sleep(<span class="number">3</span>);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"task1--end"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_async</span>(concurrentQueue, ^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"task2--start"</span>);</span><br><span class="line">    [<span class="keyword">self</span> printCurrentThread];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"task2--end"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"--end--"</span>);</span><br></pre></td></tr></table></figure>

<h3 id="实验-2：在子线程派发任务"><a href="#实验-2：在子线程派发任务" class="headerlink" title="实验 2：在子线程派发任务"></a>实验 2：在子线程派发任务</h3><ul>
<li>在 <strong>其他线程</strong> 向 <strong>主队列</strong> 执行 <strong>同步派发</strong></li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 情景 7：</span></span><br><span class="line"><span class="comment">// 在 **其他线程** 向 **主队列** 执行 **同步派发**</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> 15:34:08    --start--</span></span><br><span class="line"><span class="comment"> 15:34:08    cur = **NSThread: 0x600001019cc0**&#123;number = 7, name = (null)&#125;</span></span><br><span class="line"><span class="comment"> 15:34:08    task1--start</span></span><br><span class="line"><span class="comment"> 15:34:08    cur = **NSThread: 0x60000105c980**&#123;number = 1, name = main&#125;</span></span><br><span class="line"><span class="comment"> 15:34:11    task1--end</span></span><br><span class="line"><span class="comment"> 15:34:11    task2--start</span></span><br><span class="line"><span class="comment"> 15:34:11    cur = **NSThread: 0x60000105c980**&#123;number = 1, name = main&#125;</span></span><br><span class="line"><span class="comment"> 15:34:11    task2--end</span></span><br><span class="line"><span class="comment"> 15:34:11    --end--</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">[<span class="built_in">NSThread</span> detachNewThreadWithBlock:^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"--start--"</span>);</span><br><span class="line">    [<span class="keyword">self</span> printCurrentThread];</span><br><span class="line">    <span class="built_in">dispatch_queue_t</span> mainQueue = dispatch_get_main_queue();</span><br><span class="line">    <span class="built_in">dispatch_sync</span>(mainQueue, ^&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"task1--start"</span>);</span><br><span class="line">        [<span class="keyword">self</span> printCurrentThread];</span><br><span class="line">        sleep(<span class="number">3</span>);</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"task1--end"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">dispatch_sync</span>(mainQueue, ^&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"task2--start"</span>);</span><br><span class="line">        [<span class="keyword">self</span> printCurrentThread];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"task2--end"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"--end--"</span>);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>

<ul>
<li>在 <strong>其他线程</strong> 向 <strong>主队列</strong> 执行 <strong>异步派发</strong></li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 情景 8：</span></span><br><span class="line"><span class="comment">// 在 **其他线程** 向 **主队列** 执行 **异步派发**</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> 15:35:34    --start--</span></span><br><span class="line"><span class="comment"> 15:35:34    cur = **NSThread: 0x60000260ba80**&#123;number = 6, name = (null)&#125;</span></span><br><span class="line"><span class="comment"> 15:35:34    --end--</span></span><br><span class="line"><span class="comment"> 15:35:34    task1--start</span></span><br><span class="line"><span class="comment"> 15:35:34    cur = **NSThread: 0x600002608080**&#123;number = 1, name = main&#125;</span></span><br><span class="line"><span class="comment"> 15:35:37    task1--end</span></span><br><span class="line"><span class="comment"> 15:35:37    task2--start</span></span><br><span class="line"><span class="comment"> 15:35:37    cur = **NSThread: 0x600002608080**&#123;number = 1, name = main&#125;</span></span><br><span class="line"><span class="comment"> 15:35:37    task2--end</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">[<span class="built_in">NSThread</span> detachNewThreadWithBlock:^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"--start--"</span>);</span><br><span class="line">    [<span class="keyword">self</span> printCurrentThread];</span><br><span class="line">    <span class="built_in">dispatch_queue_t</span> mainQueue = dispatch_get_main_queue();</span><br><span class="line">    <span class="built_in">dispatch_async</span>(mainQueue, ^&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"task1--start"</span>);</span><br><span class="line">        [<span class="keyword">self</span> printCurrentThread];</span><br><span class="line">        sleep(<span class="number">3</span>);</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"task1--end"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">dispatch_async</span>(mainQueue, ^&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"task2--start"</span>);</span><br><span class="line">        [<span class="keyword">self</span> printCurrentThread];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"task2--end"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"--end--"</span>);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>

<ul>
<li>在 <strong>其他线程</strong> 向 <strong>串行队列</strong> 执行 <strong>同步派发</strong></li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 情景 9：</span></span><br><span class="line"><span class="comment">// 在 **其他线程** 向 **串行队列** 执行 **同步派发**</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> 15:39:10.    --start--</span></span><br><span class="line"><span class="comment"> 15:39:10.    cur = **NSThread: 0x60000181d840**&#123;number = 8, name = (null)&#125;</span></span><br><span class="line"><span class="comment"> 15:39:10.    task1--start</span></span><br><span class="line"><span class="comment"> 15:39:10.    cur = **NSThread: 0x60000181d840**&#123;number = 8, name = (null)&#125;</span></span><br><span class="line"><span class="comment"> 15:39:13.    task1--end</span></span><br><span class="line"><span class="comment"> 15:39:13.    task2--start</span></span><br><span class="line"><span class="comment"> 15:39:13.    cur = **NSThread: 0x60000181d840**&#123;number = 8, name = (null)&#125;</span></span><br><span class="line"><span class="comment"> 15:39:13.    task2--end</span></span><br><span class="line"><span class="comment"> 15:39:13.    --end--</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">[<span class="built_in">NSThread</span> detachNewThreadWithBlock:^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"--start--"</span>);</span><br><span class="line">    [<span class="keyword">self</span> printCurrentThread];</span><br><span class="line">    <span class="built_in">dispatch_queue_t</span> serialQueue = dispatch_queue_create(<span class="string">"serialQueue"</span>,</span><br><span class="line">                                                       DISPATCH_QUEUE_SERIAL);</span><br><span class="line">    <span class="built_in">dispatch_sync</span>(serialQueue, ^&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"task1--start"</span>);</span><br><span class="line">        [<span class="keyword">self</span> printCurrentThread];</span><br><span class="line">        sleep(<span class="number">3</span>);</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"task1--end"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">dispatch_sync</span>(serialQueue, ^&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"task2--start"</span>);</span><br><span class="line">        [<span class="keyword">self</span> printCurrentThread];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"task2--end"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"--end--"</span>);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>

<ul>
<li>在 <strong>其他线程</strong> 向 <strong>串行队列</strong> 执行 <strong>异步派发</strong></li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 情景 10：</span></span><br><span class="line"><span class="comment">// 在 **其他线程** 向 **串行队列** 执行 **异步派发**</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> 15:40:04.    --start--</span></span><br><span class="line"><span class="comment"> 15:40:04.    cur = **NSThread: 0x6000000c8e80**&#123;number = 7, name = (null)&#125;</span></span><br><span class="line"><span class="comment"> 15:40:04.    --end--</span></span><br><span class="line"><span class="comment"> 15:40:04.    task1--start</span></span><br><span class="line"><span class="comment"> 15:40:04.    cur = **NSThread: 0x6000000ced80**&#123;number = 6, name = (null)&#125;</span></span><br><span class="line"><span class="comment"> 15:40:07.    task1--end</span></span><br><span class="line"><span class="comment"> 15:40:07.    task2--start</span></span><br><span class="line"><span class="comment"> 15:40:07.    cur = **NSThread: 0x6000000ced80**&#123;number = 6, name = (null)&#125;</span></span><br><span class="line"><span class="comment"> 15:40:07.    task2--end</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">[<span class="built_in">NSThread</span> detachNewThreadWithBlock:^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"--start--"</span>);</span><br><span class="line">    [<span class="keyword">self</span> printCurrentThread];</span><br><span class="line">    <span class="built_in">dispatch_queue_t</span> serialQueue = dispatch_queue_create(<span class="string">"serialQueue"</span>,</span><br><span class="line">                                                       DISPATCH_QUEUE_SERIAL);</span><br><span class="line">    <span class="built_in">dispatch_async</span>(serialQueue, ^&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"task1--start"</span>);</span><br><span class="line">        [<span class="keyword">self</span> printCurrentThread];</span><br><span class="line">        sleep(<span class="number">3</span>);</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"task1--end"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">dispatch_async</span>(serialQueue, ^&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"task2--start"</span>);</span><br><span class="line">        [<span class="keyword">self</span> printCurrentThread];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"task2--end"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"--end--"</span>);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>

<ul>
<li>在 <strong>其他线程</strong> 向 <strong>并发队列</strong> 执行 <strong>同步派发</strong></li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 情景 11：</span></span><br><span class="line"><span class="comment">// 在 **其他线程** 向 **并发队列** 执行 **同步派发**</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> 15:41:12.    --start--</span></span><br><span class="line"><span class="comment"> 15:41:12.    cur = **NSThread: 0x600002defb80**&#123;number = 7, name = (null)&#125;</span></span><br><span class="line"><span class="comment"> 15:41:12.    task1--start</span></span><br><span class="line"><span class="comment"> 15:41:12.    cur = **NSThread: 0x600002defb80**&#123;number = 7, name = (null)&#125;</span></span><br><span class="line"><span class="comment"> 15:41:15.    task1--end</span></span><br><span class="line"><span class="comment"> 15:41:15.    task2--start</span></span><br><span class="line"><span class="comment"> 15:41:15.    cur = **NSThread: 0x600002defb80**&#123;number = 7, name = (null)&#125;</span></span><br><span class="line"><span class="comment"> 15:41:15.    task2--end</span></span><br><span class="line"><span class="comment"> 15:41:15.    --end--</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">[<span class="built_in">NSThread</span> detachNewThreadWithBlock:^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"--start--"</span>);</span><br><span class="line">    [<span class="keyword">self</span> printCurrentThread];</span><br><span class="line">    <span class="built_in">dispatch_queue_t</span> concurrentQueue = dispatch_queue_create(<span class="string">"concurrentQueue"</span>,</span><br><span class="line">                                                       DISPATCH_QUEUE_CONCURRENT);</span><br><span class="line">    <span class="built_in">dispatch_sync</span>(concurrentQueue, ^&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"task1--start"</span>);</span><br><span class="line">        [<span class="keyword">self</span> printCurrentThread];</span><br><span class="line">        sleep(<span class="number">3</span>);</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"task1--end"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">dispatch_sync</span>(concurrentQueue, ^&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"task2--start"</span>);</span><br><span class="line">        [<span class="keyword">self</span> printCurrentThread];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"task2--end"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"--end--"</span>);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>

<ul>
<li>在 <strong>其他线程</strong> 向 <strong>并发队列</strong> 执行 <strong>异步派发</strong></li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 情景 12：</span></span><br><span class="line"><span class="comment">// 在 **其他线程** 向 **并发队列** 执行 **异步派发**</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> 15:42:38    --start--</span></span><br><span class="line"><span class="comment"> 15:42:38    cur = **NSThread: 0x6000036f28c0**&#123;number = 7, name = (null)&#125;</span></span><br><span class="line"><span class="comment"> 15:42:38    --end--</span></span><br><span class="line"><span class="comment"> 15:42:38    task1--start</span></span><br><span class="line"><span class="comment"> 15:42:38    task2--start</span></span><br><span class="line"><span class="comment"> 15:42:38    cur = **NSThread: 0x6000036aac40**&#123;number = 6, name = (null)&#125;</span></span><br><span class="line"><span class="comment"> 15:42:38    cur = **NSThread: 0x6000036c2840**&#123;number = 4, name = (null)&#125;</span></span><br><span class="line"><span class="comment"> 15:42:38    task2--end</span></span><br><span class="line"><span class="comment"> 15:42:41    task1--end</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">[<span class="built_in">NSThread</span> detachNewThreadWithBlock:^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"--start--"</span>);</span><br><span class="line">    [<span class="keyword">self</span> printCurrentThread];</span><br><span class="line">    <span class="built_in">dispatch_queue_t</span> concurrentQueue = dispatch_queue_create(<span class="string">"concurrentQueue"</span>,</span><br><span class="line">                                                       DISPATCH_QUEUE_CONCURRENT);</span><br><span class="line">    <span class="built_in">dispatch_async</span>(concurrentQueue, ^&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"task1--start"</span>);</span><br><span class="line">        [<span class="keyword">self</span> printCurrentThread];</span><br><span class="line">        sleep(<span class="number">3</span>);</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"task1--end"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">dispatch_async</span>(concurrentQueue, ^&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"task2--start"</span>);</span><br><span class="line">        [<span class="keyword">self</span> printCurrentThread];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"task2--end"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"--end--"</span>);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>


<h3 id="实验结果"><a href="#实验结果" class="headerlink" title="实验结果"></a>实验结果</h3><ol>
<li><p>在主线程向主队列同步派发，会造成死锁。</p>
<p> 同步派发，会阻塞当前线程，该情况即阻塞主线程，然后等待任务返回；此时任务在主队列中，主队列中的任务需要等待主线程来执行；构成死锁。</p>
</li>
<li><p>在主线程向主队列异步派发，任务在主线程中按顺序执行。</p>
</li>
<li><p>在主线程向串行队列同步派发，任务在主线程中按顺序执行。</p>
</li>
<li><p>在主线程向串行队列异步派发，任务在同一个子线程里按顺序执行。</p>
<p> <strong>在主线程中派发任务，并不代表任务一定在主线程里执行。</strong></p>
</li>
<li><p>在主线程向并发队列同步派发，任务在主线程里按顺序执行。</p>
<p> 第 3、5 条，之所以会在主线程里执行，是因为 apple 进行了性能优化，切换线程是耗性能的。</p>
</li>
<li><p>在主线程向并发队列异步派发，任务在不同的子线程里同时执行。</p>
</li>
<li><p>在子线程向主队列同步派发，任务在主线程里按顺序执行。</p>
</li>
<li><p>在子线程向主队列异步派发，任务在主线程里按顺序执行。</p>
</li>
<li><p>在子线程向串行队列同步派发，任务在同一个子线程里按顺序执行。</p>
</li>
<li><p>在子线程向串行队列异步派发，任务在同一个子线程里按顺序执行，但是该子线程不是当前子线程。</p>
</li>
<li><p>在子线程向并发队列同步派发，任务在同一个子线程里按顺序执行。</p>
</li>
<li><p>在子线程向并发队列异步派发，任务在两个不同的子线程里同时执行，并且与当前子线程也不相同。</p>
</li>
</ol>
<h2 id="一些结论"><a href="#一些结论" class="headerlink" title="一些结论"></a>一些结论</h2><ul>
<li>主队列的任务都在主线程里执行</li>
<li>主线程里派发任务，不一定在主线程里执行（4 主线程里向串行队列异步派发，任务在子线程里执行）</li>
<li>同步派发的特征是塞当前线程，而不是让任务在当前线程立即执行（5 子线程向主队列同步派发，任务在主线程里执行）</li>
<li>串行队列异步派发，任务会在一个新子线程中执行（4 10 主线程/子线程向串行队列异步派发）</li>
<li>串行队列同步派发，任务会在当前线程中执行（3 9 主线程/子线程向串行队列同步派发）</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://skybrim.top/2019/01/01/ios/thread-queue-dispatch/" data-id="ckiia424q0044mobm1h2phyi6" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/" rel="tag">iOS</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/01/01/ios/popover/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Popover
        
      </div>
    </a>
  
  
    <a href="/2019/01/01/ios/uifont/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">UIFont</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/algorithm/" rel="tag">algorithm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/" rel="tag">css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ffmpeg/" rel="tag">ffmpeg</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/" rel="tag">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/homebrew/" rel="tag">homebrew</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/" rel="tag">http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iOS/" rel="tag">iOS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/inbox/" rel="tag">inbox</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kindle/" rel="tag">kindle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/proxy/" rel="tag">proxy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/raspberry-pi/" rel="tag">raspberry-pi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react/" rel="tag">react</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/swift/" rel="tag">swift</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/travel/" rel="tag">travel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/" rel="tag">vim</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web/" rel="tag">web</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/algorithm/" style="font-size: 16px;">algorithm</a> <a href="/tags/css/" style="font-size: 14px;">css</a> <a href="/tags/ffmpeg/" style="font-size: 16px;">ffmpeg</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/hexo/" style="font-size: 12px;">hexo</a> <a href="/tags/homebrew/" style="font-size: 10px;">homebrew</a> <a href="/tags/http/" style="font-size: 10px;">http</a> <a href="/tags/iOS/" style="font-size: 20px;">iOS</a> <a href="/tags/inbox/" style="font-size: 18px;">inbox</a> <a href="/tags/kindle/" style="font-size: 10px;">kindle</a> <a href="/tags/proxy/" style="font-size: 10px;">proxy</a> <a href="/tags/raspberry-pi/" style="font-size: 14px;">raspberry-pi</a> <a href="/tags/react/" style="font-size: 10px;">react</a> <a href="/tags/swift/" style="font-size: 16px;">swift</a> <a href="/tags/travel/" style="font-size: 10px;">travel</a> <a href="/tags/vim/" style="font-size: 14px;">vim</a> <a href="/tags/web/" style="font-size: 16px;">web</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/09/24/web/css-layout/">css 布局</a>
          </li>
        
          <li>
            <a href="/2020/09/24/web/css-box-model/">css 盒模型</a>
          </li>
        
          <li>
            <a href="/2020/09/23/web/react-useReducer-useContext/">react-useReducer-useContext</a>
          </li>
        
          <li>
            <a href="/2020/09/23/web/css-selectors/">css-selectors</a>
          </li>
        
          <li>
            <a href="/2020/08/08/inbox/homebrew-source/">homebrew-source</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 Wiley<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>